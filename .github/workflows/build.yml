name: Build Action

on:
  push:
    branches:
      - main
      - dev
    tags: [ 'v*' ]
    paths:
      - '**.java'
      - '**.kt'
      - '.github/workflows/build.yml'
      - 'gradle/**'
      - '**.gradle'
      - '**.kts'
  pull_request:
    branches:
      - main
      - dev
    paths:
      - '**.java'
      - '**.kt'
      - '.github/workflows/build.yml'
      - 'gradle/**'
      - '**.gradle'
      - '**.kts'
  workflow_dispatch:
    inputs:
      release:
        description: 'Publish a new release (default: to snapshots)'
        required: false
        type: boolean
        default: false

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: ${{ !startsWith(github.ref, 'refs/tags/v')}}

jobs:
  build-and-publish:
    name: Build and Publish
    uses: NeoTamia/actions/.github/workflows/jvm-build-and-publish.yml@main
    with:
      build-command: './gradlew build "-Pspotless.enforceCheck=false"'
      release: ${{ startsWith(github.ref, 'refs/tags/v') || github.event.inputs.release == 'true' }}
    secrets: inherit
